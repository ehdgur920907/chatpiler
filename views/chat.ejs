<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>chat</title>
	<!-- socket.io CDN -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>

	<!-- jQuery CDN -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

	<!-- Bootstrap CDN -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
</head>

<body>
	<nav class="navbar navbar-default">
		<div class="container-fluid">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span> <span
					class="icon-bar"></span> <span class="icon-bar"></span> <span
					class="icon-bar"></span>
			</button>
				<a class="navbar-brand" href="/welcome"><span
				class="glyphicon glyphicon-home" aria-hidden="true"></span></a>
			</div>

			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav navbar-right">
					<li><a href="/file">file</a></li>
					<li><a href="/chat">chat</a></li>
					<li><a href="/my">my</a></li>
					<li><a href="/signout">signout</a></li>
					<% if (!user) { %>
						<li><a href="/signin">signin</a></li>
						<li><a href="/signup">signup</a></li>
					<% } %>
				</ul>
			</div>
			<!-- /.navbar-collapse -->
		</div>
		<!-- /.container-fluid -->
	</nav>
	<div class="container">
		<div class="jumbotron" style="width: 50%; margin: auto;">
			<div class="row">
				<div class="panel panel-primary">
					<div class="panel-heading">
						<span class="glyphicon glyphicon-comment"></span>&nbsp;&nbsp;chat (<span id="user-count"></span>)
					</div>
					<div class="panel-body">
						<ul class="chat">
							<li>welcome to chat service.</li>
						</ul>
					</div>
					<div class="panel-footer">
						<div class="input-group">
							<input id="btn-input" type="text" class="form-control input-sm" placeholder="type your message.">
							<span class="input-group-btn">
                            <button class="btn btn-warning btn-sm" id="btn-chat">
                                send</button>
                        </span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
<script>
	$(() => {
		const socket = io.connect();

		socket.emit('login', {
			name: 'donghyuk',
			email: 'ehdgur920907@gmail.com'
		});

		socket.on('login', data => {
			$('.chat').append(`<li>${ data } has joined.</li>`);
		});

		socket.on('chat', data => {
			$('.chat').append(`<li>${ data.from.name }: ${ data.message }</li>`);
		});

		$('#btn-chat').click(e => {
			e.preventDefault();
			socket.emit('chat', {
				message: $('#btn-input').val()
			});
			$('#btn-input').val("");
		});
	});
</script>
</html>